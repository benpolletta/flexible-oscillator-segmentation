1c1,3
< function [T,pop1_v,pop1_iNa_m,pop1_iNa_h,pop1_iK_n]=solve_ode
---
> function [T,deepFS_V,deepFS_FSiNaF_hNaF,deepFS_FSiKDR_mKDR,deepRS_V,deepRS_iNaP_m,deepRS_iKs_n,deepRS_iKsConst_n,deepRS_iKDRG_mKDR,deepRS_iNaG_h,deepRS_CaDynT_cai,deepRS_iCaT_s,deepRS_iKCaT_q,deepFS_deepRS_IBaIBdbiSYNseed_s,deepRS_deepFS_IBaIBdbiSYNseed_s,deepFS_FSiKDR_IKDR,deepFS_FSiKDR_aM,deepFS_FSiKDR_bM,deepFS_FSiKDR_minf,deepFS_FSiKDR_mtau,deepFS_FSiNaF_INaF,deepFS_FSiNaF_aH,deepFS_FSiNaF_bH,deepFS_FSiNaF_hinf,deepFS_FSiNaF_htau,deepFS_FSiNaF_m0,deepFS_IBitonic_Itonic,deepFS_IBleak_Ileak,deepFS_IBnoise_Inoise,deepFS_deepRS_IBaIBdbiSYNseed_ISYN,deepRS_deepFS_IBaIBdbiSYNseed_ISYN,deepRS_iCaT_ICa,deepRS_iCaT_as,deepRS_iCaT_bs,deepRS_iCaT_sinf,deepRS_iCaT_stau,deepRS_iCarracedoEPSPs_Iext,deepRS_iFMPulses_Iext,deepRS_iFMPulses_input,deepRS_iKCaT_IKCa,deepRS_iKCaT_aKCa,deepRS_iKCaT_infKCa,deepRS_iKCaT_tauKCa,deepRS_iKDRG_IKDR,deepRS_iKDRG_aM,deepRS_iKDRG_bM,deepRS_iKsConst_IKs,deepRS_iKsConst_ninf,deepRS_iKs_IKs,deepRS_iKs_ninf,deepRS_iKs_tauKs,deepRS_iLeak_Il,deepRS_iNaG_INa,deepRS_iNaG_ah,deepRS_iNaG_am,deepRS_iNaG_bh,deepRS_iNaG_bm,deepRS_iNaG_minf,deepRS_iNaP_INaP,deepRS_iNaP_minf,deepRS_iPeriodicPulsesBen_Iext,deepRS_iPeriodicPulsesBen_input,deepRS_itonicBen_IBen,deepRS_iKs_tau_div,deepRS_iKDRG_tau_m,deepRS_iNaG_tau_h,deepRS_iPeriodicPulsesBen_PPwidth,deepRS_iPeriodicPulsesBen_Tend,deepRS_iPeriodicPulsesBen_s2,deepRS_itonicBen_toff,deepRS_iFMPulses_FMPwindowlength,deepRS_iFMPulses_Tend,deepRS_iFMPulses_sampling_freq,deepRS_iFMPulses_s2,deepRS_iCarracedoEPSPs_epsps,deepFS_deepRS_IBaIBdbiSYNseed_UB,deepFS_deepRS_IBaIBdbiSYNseed_Xpre,deepFS_deepRS_IBaIBdbiSYNseed_Xpost,deepFS_deepRS_IBaIBdbiSYNseed_mask,deepFS_deepRS_IBaIBdbiSYNseed_gsyn,deepRS_deepFS_IBaIBdbiSYNseed_UB,deepRS_deepFS_IBaIBdbiSYNseed_Xpre,deepRS_deepFS_IBaIBdbiSYNseed_Xpost,deepRS_deepFS_IBaIBdbiSYNseed_mask,deepRS_deepFS_IBaIBdbiSYNseed_gsyn]=solve_ode(simID)
> assert(isa(simID, 'double'));
> % nSims = 201 (needed for one_solve_file_flag mex differentiation)
6c8,136
< p = params.p;
---
> pVecs = params.p;
> p.deepRS_deepFS_IBaIBdbiSYNseed_g_SYN = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_g_SYN(simID);
> p.deepFS_deepRS_IBaIBdbiSYNseed_g_SYN = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_g_SYN(simID);
> p.deepFS_deepRS_IBaIBdbiSYNseed_tauRx = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_tauRx(simID);
> p.deepFS_deepRS_IBaIBdbiSYNseed_tauDx = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_tauDx(simID);
> p.deepRS_deepFS_IBaIBdbiSYNseed_tauDx = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_tauDx(simID);
> p.deepRS_deepFS_IBaIBdbiSYNseed_tauRx = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_tauRx(simID);
> p.deepRS_itonicBen_I_app = pVecs.deepRS_itonicBen_I_app(simID);
> p.deepFS_IBitonic_stim = pVecs.deepFS_IBitonic_stim(simID);
> p.deepRS_iLeak_gl = pVecs.deepRS_iLeak_gl(simID);
> p.deepRS_iNaP_gNaP = pVecs.deepRS_iNaP_gNaP(simID);
> p.deepRS_iFMPulses_FMPstim = pVecs.deepRS_iFMPulses_FMPstim(simID);
> p.deepRS_iPeriodicPulsesBen_PPstim = pVecs.deepRS_iPeriodicPulsesBen_PPstim(simID);
> p.deepRS_iKs_gKs = pVecs.deepRS_iKs_gKs(simID);
> p.deepRS_iKCaT_gKCa = pVecs.deepRS_iKCaT_gKCa(simID);
> p.deepRS_iKCaT_bKCa = pVecs.deepRS_iKCaT_bKCa(simID);
> p.tspan = pVecs.tspan;
> p.downsample_factor = pVecs.downsample_factor;
> p.random_seed = pVecs.random_seed;
> p.solver = pVecs.solver;
> p.disk_flag = pVecs.disk_flag;
> p.dt = pVecs.dt;
> p.datafile = pVecs.datafile;
> p.mex_flag = pVecs.mex_flag;
> p.verbose_flag = pVecs.verbose_flag;
> p.deepFS_Cm = pVecs.deepFS_Cm;
> p.deepFS_IBitonic_onset = pVecs.deepFS_IBitonic_onset;
> p.deepFS_IBitonic_offset = pVecs.deepFS_IBitonic_offset;
> p.deepFS_IBnoise_V_noise = pVecs.deepFS_IBnoise_V_noise;
> p.deepFS_FSiNaF_gNaF = pVecs.deepFS_FSiNaF_gNaF;
> p.deepFS_FSiNaF_NaF_V0 = pVecs.deepFS_FSiNaF_NaF_V0;
> p.deepFS_FSiNaF_NaF_V1 = pVecs.deepFS_FSiNaF_NaF_V1;
> p.deepFS_FSiNaF_NaF_d1 = pVecs.deepFS_FSiNaF_NaF_d1;
> p.deepFS_FSiNaF_NaF_V2 = pVecs.deepFS_FSiNaF_NaF_V2;
> p.deepFS_FSiNaF_NaF_d2 = pVecs.deepFS_FSiNaF_NaF_d2;
> p.deepFS_FSiNaF_NaF_c0 = pVecs.deepFS_FSiNaF_NaF_c0;
> p.deepFS_FSiNaF_NaF_c1 = pVecs.deepFS_FSiNaF_NaF_c1;
> p.deepFS_FSiNaF_E_NaF = pVecs.deepFS_FSiNaF_E_NaF;
> p.deepFS_FSiNaF_IC = pVecs.deepFS_FSiNaF_IC;
> p.deepFS_FSiNaF_IC_noise = pVecs.deepFS_FSiNaF_IC_noise;
> p.deepFS_FSiNaF_NaF_offset = pVecs.deepFS_FSiNaF_NaF_offset;
> p.deepFS_FSiKDR_gKDR = pVecs.deepFS_FSiKDR_gKDR;
> p.deepFS_FSiKDR_KDR_V1 = pVecs.deepFS_FSiKDR_KDR_V1;
> p.deepFS_FSiKDR_KDR_d1 = pVecs.deepFS_FSiKDR_KDR_d1;
> p.deepFS_FSiKDR_KDR_V2 = pVecs.deepFS_FSiKDR_KDR_V2;
> p.deepFS_FSiKDR_KDR_d2 = pVecs.deepFS_FSiKDR_KDR_d2;
> p.deepFS_FSiKDR_E_KDR = pVecs.deepFS_FSiKDR_E_KDR;
> p.deepFS_FSiKDR_IC = pVecs.deepFS_FSiKDR_IC;
> p.deepFS_FSiKDR_IC_noise = pVecs.deepFS_FSiKDR_IC_noise;
> p.deepFS_FSiKDR_KDR_offset = pVecs.deepFS_FSiKDR_KDR_offset;
> p.deepFS_IBleak_g_l = pVecs.deepFS_IBleak_g_l;
> p.deepFS_IBleak_E_l = pVecs.deepFS_IBleak_E_l;
> p.deepFS_Npop = pVecs.deepFS_Npop;
> p.deepRS_Cm = pVecs.deepRS_Cm;
> p.deepRS_I_const = pVecs.deepRS_I_const;
> p.deepRS_iNaP_ENa = pVecs.deepRS_iNaP_ENa;
> p.deepRS_iNaP_tauNaP = pVecs.deepRS_iNaP_tauNaP;
> p.deepRS_iNaP_halfNaP = pVecs.deepRS_iNaP_halfNaP;
> p.deepRS_iNaP_IC_noise = pVecs.deepRS_iNaP_IC_noise;
> p.deepRS_iNaP_m_IC = pVecs.deepRS_iNaP_m_IC;
> p.deepRS_iNaP_NaP_offset = pVecs.deepRS_iNaP_NaP_offset;
> p.deepRS_iKs_E_Ks = pVecs.deepRS_iKs_E_Ks;
> p.deepRS_iKs_halfKs = pVecs.deepRS_iKs_halfKs;
> p.deepRS_iKs_temp = pVecs.deepRS_iKs_temp;
> p.deepRS_iKs_IC = pVecs.deepRS_iKs_IC;
> p.deepRS_iKs_IC_noise = pVecs.deepRS_iKs_IC_noise;
> p.deepRS_iKs_tau_mult = pVecs.deepRS_iKs_tau_mult;
> p.deepRS_iKs_Ks_offset = pVecs.deepRS_iKs_Ks_offset;
> p.deepRS_iKsConst_gKCs = pVecs.deepRS_iKsConst_gKCs;
> p.deepRS_iKsConst_E_Ks = pVecs.deepRS_iKsConst_E_Ks;
> p.deepRS_iKsConst_halfKs = pVecs.deepRS_iKsConst_halfKs;
> p.deepRS_iKsConst_temp = pVecs.deepRS_iKsConst_temp;
> p.deepRS_iKsConst_IC = pVecs.deepRS_iKsConst_IC;
> p.deepRS_iKsConst_IC_noise = pVecs.deepRS_iKsConst_IC_noise;
> p.deepRS_iKsConst_tau_Ks = pVecs.deepRS_iKsConst_tau_Ks;
> p.deepRS_iKDRG_gKDR = pVecs.deepRS_iKDRG_gKDR;
> p.deepRS_iKDRG_gdenomK = pVecs.deepRS_iKDRG_gdenomK;
> p.deepRS_iKDRG_E_KDR = pVecs.deepRS_iKDRG_E_KDR;
> p.deepRS_iKDRG_temp = pVecs.deepRS_iKDRG_temp;
> p.deepRS_iKDRG_IC = pVecs.deepRS_iKDRG_IC;
> p.deepRS_iKDRG_IC_noise = pVecs.deepRS_iKDRG_IC_noise;
> p.deepRS_iKDRG_Koffset = pVecs.deepRS_iKDRG_Koffset;
> p.deepRS_iNaG_gNa = pVecs.deepRS_iNaG_gNa;
> p.deepRS_iNaG_gdenomN = pVecs.deepRS_iNaG_gdenomN;
> p.deepRS_iNaG_ENa = pVecs.deepRS_iNaG_ENa;
> p.deepRS_iNaG_temp = pVecs.deepRS_iNaG_temp;
> p.deepRS_iNaG_IC = pVecs.deepRS_iNaG_IC;
> p.deepRS_iNaG_IC_noise = pVecs.deepRS_iNaG_IC_noise;
> p.deepRS_iNaG_Noffset = pVecs.deepRS_iNaG_Noffset;
> p.deepRS_iLeak_gdenoml = pVecs.deepRS_iLeak_gdenoml;
> p.deepRS_iLeak_El = pVecs.deepRS_iLeak_El;
> p.deepRS_CaDynT_cainf = pVecs.deepRS_CaDynT_cainf;
> p.deepRS_CaDynT_tauCa = pVecs.deepRS_CaDynT_tauCa;
> p.deepRS_CaDynT_CAF = pVecs.deepRS_CaDynT_CAF;
> p.deepRS_CaDynT_IC_noise = pVecs.deepRS_CaDynT_IC_noise;
> p.deepRS_iCaT_gCa = pVecs.deepRS_iCaT_gCa;
> p.deepRS_iCaT_ECa = pVecs.deepRS_iCaT_ECa;
> p.deepRS_iCaT_IC_noise = pVecs.deepRS_iCaT_IC_noise;
> p.deepRS_iCaT_Caoffset = pVecs.deepRS_iCaT_Caoffset;
> p.deepRS_iKCaT_EK = pVecs.deepRS_iKCaT_EK;
> p.deepRS_iKCaT_IC_noise = pVecs.deepRS_iKCaT_IC_noise;
> p.deepRS_iKCaT_aKCa_factor = pVecs.deepRS_iKCaT_aKCa_factor;
> p.deepRS_iPeriodicPulsesBen_PPfreq = pVecs.deepRS_iPeriodicPulsesBen_PPfreq;
> p.deepRS_iPeriodicPulsesBen_PPduty = pVecs.deepRS_iPeriodicPulsesBen_PPduty;
> p.deepRS_iPeriodicPulsesBen_PPshift = pVecs.deepRS_iPeriodicPulsesBen_PPshift;
> p.deepRS_iPeriodicPulsesBen_PPcenter = pVecs.deepRS_iPeriodicPulsesBen_PPcenter;
> p.deepRS_iPeriodicPulsesBen_PPnorm = pVecs.deepRS_iPeriodicPulsesBen_PPnorm;
> p.deepRS_iPeriodicPulsesBen_dt = pVecs.deepRS_iPeriodicPulsesBen_dt;
> p.deepRS_iPeriodicPulsesBen_PPonset = pVecs.deepRS_iPeriodicPulsesBen_PPonset;
> p.deepRS_iPeriodicPulsesBen_PPoffset = pVecs.deepRS_iPeriodicPulsesBen_PPoffset;
> p.deepRS_iPeriodicPulsesBen_kernel_type = pVecs.deepRS_iPeriodicPulsesBen_kernel_type;
> p.deepRS_iPeriodicPulsesBen_width2_rise = pVecs.deepRS_iPeriodicPulsesBen_width2_rise;
> p.deepRS_itonicBen_ton = pVecs.deepRS_itonicBen_ton;
> p.deepRS_itonicBen_Inoise = pVecs.deepRS_itonicBen_Inoise;
> p.deepRS_iFMPulses_FMPlowfreq = pVecs.deepRS_iFMPulses_FMPlowfreq;
> p.deepRS_iFMPulses_FMPhighfreq = pVecs.deepRS_iFMPulses_FMPhighfreq;
> p.deepRS_iFMPulses_dt = pVecs.deepRS_iFMPulses_dt;
> p.deepRS_iCarracedoEPSPs_gCar = pVecs.deepRS_iCarracedoEPSPs_gCar;
> p.deepRS_Npop = pVecs.deepRS_Npop;
> p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN;
> p.deepFS_deepRS_IBaIBdbiSYNseed_IC = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_IC;
> p.deepFS_deepRS_IBaIBdbiSYNseed_IC_noise = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_IC_noise;
> p.deepFS_deepRS_IBaIBdbiSYNseed_gSYNhetero = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_gSYNhetero;
> p.deepFS_deepRS_IBaIBdbiSYNseed_fanout = pVecs.deepFS_deepRS_IBaIBdbiSYNseed_fanout;
> p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN;
> p.deepRS_deepFS_IBaIBdbiSYNseed_IC = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_IC;
> p.deepRS_deepFS_IBaIBdbiSYNseed_IC_noise = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_IC_noise;
> p.deepRS_deepFS_IBaIBdbiSYNseed_gSYNhetero = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_gSYNhetero;
> p.deepRS_deepFS_IBaIBdbiSYNseed_fanout = pVecs.deepRS_deepFS_IBaIBdbiSYNseed_fanout;
14a145,173
> % Fixed variables:
> % ------------------------------------------------------------
> % seed the random number generator
> rng(p.random_seed);
> deepRS_iKs_tau_div =  3^((p.deepRS_iKs_temp-22)/10);
> deepRS_iKDRG_tau_m = +5.000000000000000e+00;
> deepRS_iNaG_tau_h = +5.000000000000000e+00;
> deepRS_iPeriodicPulsesBen_PPwidth =  (1000/p.deepRS_iPeriodicPulsesBen_PPfreq)*p.deepRS_iPeriodicPulsesBen_PPduty;
> deepRS_iPeriodicPulsesBen_Tend = T(end);
> deepRS_iPeriodicPulsesBen_s2 =  getPeriodicPulseFastBensVersion(p.deepRS_iPeriodicPulsesBen_PPfreq,deepRS_iPeriodicPulsesBen_PPwidth,p.deepRS_iPeriodicPulsesBen_PPshift,deepRS_iPeriodicPulsesBen_Tend,p.deepRS_iPeriodicPulsesBen_dt,p.deepRS_iPeriodicPulsesBen_PPonset,p.deepRS_iPeriodicPulsesBen_PPoffset,p.deepRS_Npop,p.deepRS_iPeriodicPulsesBen_kernel_type,p.deepRS_iPeriodicPulsesBen_width2_rise,p.deepRS_iPeriodicPulsesBen_PPcenter,p.deepRS_iPeriodicPulsesBen_PPnorm,0);
> deepRS_itonicBen_toff = +6.000000000000000e+03;
> deepRS_iFMPulses_FMPwindowlength =  (1000/mean([p.deepRS_iFMPulses_FMPlowfreq p.deepRS_iFMPulses_FMPhighfreq]));
> deepRS_iFMPulses_Tend = T(end);
> deepRS_iFMPulses_sampling_freq =  1000/p.deepRS_iFMPulses_dt;
> deepRS_iFMPulses_s2 =  phase_modulated(p.deepRS_iFMPulses_dt, deepRS_iFMPulses_Tend, deepRS_iFMPulses_sampling_freq, [p.deepRS_iFMPulses_FMPlowfreq p.deepRS_iFMPulses_FMPhighfreq], deepRS_iFMPulses_FMPwindowlength, 1);
> deepRS_iCarracedoEPSPs_epsps = load('CarracedoEPSPs.txt');
> deepFS_deepRS_IBaIBdbiSYNseed_UB =  max(p.deepRS_Npop,p.deepFS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_Xpre =  linspace(1,deepFS_deepRS_IBaIBdbiSYNseed_UB,p.deepRS_Npop)'*ones(1,p.deepFS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_Xpost =  (linspace(1,deepFS_deepRS_IBaIBdbiSYNseed_UB,p.deepFS_Npop)'*ones(1,p.deepRS_Npop))';
> deepFS_deepRS_IBaIBdbiSYNseed_mask =  (abs(deepFS_deepRS_IBaIBdbiSYNseed_Xpre-deepFS_deepRS_IBaIBdbiSYNseed_Xpost)<=p.deepFS_deepRS_IBaIBdbiSYNseed_fanout);
> deepFS_deepRS_IBaIBdbiSYNseed_gsyn = unifrnd(p.deepFS_deepRS_IBaIBdbiSYNseed_g_SYN-p.deepFS_deepRS_IBaIBdbiSYNseed_gSYNhetero,p.deepFS_deepRS_IBaIBdbiSYNseed_g_SYN+p.deepFS_deepRS_IBaIBdbiSYNseed_gSYNhetero,[p.deepFS_Npop 1])';
> deepRS_deepFS_IBaIBdbiSYNseed_UB =  max(p.deepFS_Npop,p.deepRS_Npop);
> deepRS_deepFS_IBaIBdbiSYNseed_Xpre =  linspace(1,deepRS_deepFS_IBaIBdbiSYNseed_UB,p.deepFS_Npop)'*ones(1,p.deepRS_Npop);
> deepRS_deepFS_IBaIBdbiSYNseed_Xpost =  (linspace(1,deepRS_deepFS_IBaIBdbiSYNseed_UB,p.deepRS_Npop)'*ones(1,p.deepFS_Npop))';
> deepRS_deepFS_IBaIBdbiSYNseed_mask =  (abs(deepRS_deepFS_IBaIBdbiSYNseed_Xpre-deepRS_deepFS_IBaIBdbiSYNseed_Xpost)<=p.deepRS_deepFS_IBaIBdbiSYNseed_fanout);
> deepRS_deepFS_IBaIBdbiSYNseed_gsyn = unifrnd(p.deepRS_deepFS_IBaIBdbiSYNseed_g_SYN-p.deepRS_deepFS_IBaIBdbiSYNseed_gSYNhetero,p.deepRS_deepFS_IBaIBdbiSYNseed_g_SYN+p.deepRS_deepFS_IBaIBdbiSYNseed_gSYNhetero,[p.deepRS_Npop 1])';
> 
> 
> % ------------------------------------------------------------
22,29c181,368
< pop1_v = zeros(nsamp,p.pop1_Npop);
< pop1_v(1,:) = zeros(1,p.pop1_Npop);
< pop1_iNa_m = zeros(nsamp,p.pop1_Npop);
< pop1_iNa_m(1,:) = p.pop1_iNa_m_IC+p.pop1_iNa_IC_noise*rand(1,p.pop1_Npop);
< pop1_iNa_h = zeros(nsamp,p.pop1_Npop);
< pop1_iNa_h(1,:) = p.pop1_iNa_h_IC+p.pop1_iNa_IC_noise*rand(1,p.pop1_Npop);
< pop1_iK_n = zeros(nsamp,p.pop1_Npop);
< pop1_iK_n(1,:) = p.pop1_iK_n_IC+p.pop1_iK_IC_noise*rand(1,p.pop1_Npop);
---
> deepFS_V_last = -65 * ones(1,p.deepFS_Npop);
> deepFS_V = zeros(nsamp,p.deepFS_Npop);
> deepFS_V(1,:) = deepFS_V_last;
> deepFS_FSiNaF_hNaF_last =  p.deepFS_FSiNaF_IC+p.deepFS_FSiNaF_IC_noise.*rand(1,p.deepFS_Npop);
> deepFS_FSiNaF_hNaF = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_hNaF(1,:) = deepFS_FSiNaF_hNaF_last;
> deepFS_FSiKDR_mKDR_last =  p.deepFS_FSiKDR_IC+p.deepFS_FSiKDR_IC_noise.*rand(1,p.deepFS_Npop);
> deepFS_FSiKDR_mKDR = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_mKDR(1,:) = deepFS_FSiKDR_mKDR_last;
> deepRS_V_last = -65 * ones(1,p.deepRS_Npop);
> deepRS_V = zeros(nsamp,p.deepRS_Npop);
> deepRS_V(1,:) = deepRS_V_last;
> deepRS_iNaP_m_last = p.deepRS_iNaP_m_IC+p.deepRS_iNaP_IC_noise*rand(1,p.deepRS_Npop);
> deepRS_iNaP_m = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaP_m(1,:) = deepRS_iNaP_m_last;
> deepRS_iKs_n_last = p.deepRS_iKs_IC+p.deepRS_iKs_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iKs_n = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKs_n(1,:) = deepRS_iKs_n_last;
> deepRS_iKsConst_n_last = p.deepRS_iKsConst_IC+p.deepRS_iKsConst_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iKsConst_n = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKsConst_n(1,:) = deepRS_iKsConst_n_last;
> deepRS_iKDRG_mKDR_last =  p.deepRS_iKDRG_IC+p.deepRS_iKDRG_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iKDRG_mKDR = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKDRG_mKDR(1,:) = deepRS_iKDRG_mKDR_last;
> deepRS_iNaG_h_last =  p.deepRS_iNaG_IC+p.deepRS_iNaG_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iNaG_h = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_h(1,:) = deepRS_iNaG_h_last;
> deepRS_CaDynT_cai_last =  p.deepRS_CaDynT_cainf + p.deepRS_CaDynT_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_CaDynT_cai = zeros(nsamp,p.deepRS_Npop);
> deepRS_CaDynT_cai(1,:) = deepRS_CaDynT_cai_last;
> deepRS_iCaT_s_last =  (( 1.6./(1+exp(-.072*((-65)-p.deepRS_iCaT_Caoffset-65)))))/((( 1.6./(1+exp(-.072*((-65)-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*((-65)-p.deepRS_iCaT_Caoffset-51.1)./(exp(((-65)-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))+p.deepRS_iCaT_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iCaT_s = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_s(1,:) = deepRS_iCaT_s_last;
> deepRS_iKCaT_q_last =  (( (( min(p.deepRS_iKCaT_aKCa_factor.*(0),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*(0),1)))+p.deepRS_iKCaT_bKCa)))+p.deepRS_iKCaT_IC_noise.*rand(1,p.deepRS_Npop);
> deepRS_iKCaT_q = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKCaT_q(1,:) = deepRS_iKCaT_q_last;
> deepFS_deepRS_IBaIBdbiSYNseed_s_last =  p.deepFS_deepRS_IBaIBdbiSYNseed_IC*ones(1,p.deepRS_Npop)+p.deepFS_deepRS_IBaIBdbiSYNseed_IC_noise.*rand(1,p.deepRS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_s = zeros(nsamp,p.deepRS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_s(1,:) = deepFS_deepRS_IBaIBdbiSYNseed_s_last;
> deepRS_deepFS_IBaIBdbiSYNseed_s_last =  p.deepRS_deepFS_IBaIBdbiSYNseed_IC*ones(1,p.deepFS_Npop)+p.deepRS_deepFS_IBaIBdbiSYNseed_IC_noise.*rand(1,p.deepFS_Npop);
> deepRS_deepFS_IBaIBdbiSYNseed_s = zeros(nsamp,p.deepFS_Npop);
> deepRS_deepFS_IBaIBdbiSYNseed_s(1,:) = deepRS_deepFS_IBaIBdbiSYNseed_s_last;
> 
> % MONITORS:
> deepFS_FSiKDR_IKDR_last =p.deepFS_FSiKDR_gKDR.*deepFS_FSiKDR_mKDR_last.^4.*(deepFS_V_last-p.deepFS_FSiKDR_E_KDR);
> deepFS_FSiKDR_IKDR = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_IKDR(1,:) =p.deepFS_FSiKDR_gKDR.*deepFS_FSiKDR_mKDR(1,:).^4.*(deepFS_V(1,:)-p.deepFS_FSiKDR_E_KDR);
> deepFS_FSiKDR_aM_last =(( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(deepFS_V_last+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_aM = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_aM(1,:) =(( 1./(1+exp((-deepFS_V(1,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(deepFS_V(1,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_bM_last =(1-(( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(deepFS_V_last+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_bM = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_bM(1,:) =(1-(( 1./(1+exp((-deepFS_V(1,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(deepFS_V(1,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_minf_last =1./(1+exp((-deepFS_V_last-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1));
> deepFS_FSiKDR_minf = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_minf(1,:) =1./(1+exp((-deepFS_V(1,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1));
> deepFS_FSiKDR_mtau_last =.25+4.35*exp(-abs(deepFS_V_last+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2);
> deepFS_FSiKDR_mtau = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiKDR_mtau(1,:) =.25+4.35*exp(-abs(deepFS_V(1,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2);
> deepFS_FSiNaF_INaF_last =p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*deepFS_FSiNaF_hNaF_last.*(deepFS_V_last-p.deepFS_FSiNaF_E_NaF);
> deepFS_FSiNaF_INaF = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_INaF(1,:) =p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-deepFS_V(1,:)-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*deepFS_FSiNaF_hNaF(1,:).*(deepFS_V(1,:)-p.deepFS_FSiNaF_E_NaF);
> deepFS_FSiNaF_aH_last =(( 1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_aH = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_aH(1,:) =(( 1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_bH_last =(1-(( 1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_bH = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_bH(1,:) =(1-(( 1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_hinf_last =1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1));
> deepFS_FSiNaF_hinf = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_hinf(1,:) =1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1));
> deepFS_FSiNaF_htau_last =p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2));
> deepFS_FSiNaF_htau = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_htau(1,:) =p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(1,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2));
> deepFS_FSiNaF_m0_last =1./(1+exp((-deepFS_V_last-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10));
> deepFS_FSiNaF_m0 = zeros(nsamp,p.deepFS_Npop);
> deepFS_FSiNaF_m0(1,:) =1./(1+exp((-deepFS_V(1,:)-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10));
> deepFS_IBitonic_Itonic_last =p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset);
> deepFS_IBitonic_Itonic = zeros(nsamp,p.deepFS_Npop);
> deepFS_IBitonic_Itonic(1,:) =p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset);
> deepFS_IBleak_Ileak_last =p.deepFS_IBleak_g_l.*(deepFS_V_last-p.deepFS_IBleak_E_l);
> deepFS_IBleak_Ileak = zeros(nsamp,p.deepFS_Npop);
> deepFS_IBleak_Ileak(1,:) =p.deepFS_IBleak_g_l.*(deepFS_V(1,:)-p.deepFS_IBleak_E_l);
> deepFS_IBnoise_Inoise_last =p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop);
> deepFS_IBnoise_Inoise = zeros(nsamp,p.deepFS_Npop);
> deepFS_IBnoise_Inoise(1,:) =p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_ISYN_last =(deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(deepFS_deepRS_IBaIBdbiSYNseed_s_last*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(deepFS_V_last-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN));
> deepFS_deepRS_IBaIBdbiSYNseed_ISYN = zeros(nsamp,p.deepFS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_ISYN(1,:) =(deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(deepFS_deepRS_IBaIBdbiSYNseed_s(1,:)*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(deepFS_V(1,:)-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN));
> deepRS_deepFS_IBaIBdbiSYNseed_ISYN_last =(deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(deepRS_deepFS_IBaIBdbiSYNseed_s_last*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(deepRS_V_last-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN));
> deepRS_deepFS_IBaIBdbiSYNseed_ISYN = zeros(nsamp,p.deepRS_Npop);
> deepRS_deepFS_IBaIBdbiSYNseed_ISYN(1,:) =(deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(deepRS_deepFS_IBaIBdbiSYNseed_s(1,:)*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(deepRS_V(1,:)-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN));
> deepRS_iCaT_ICa_last =p.deepRS_iCaT_gCa.*(deepRS_iCaT_s_last.^2).*(deepRS_V_last-p.deepRS_iCaT_ECa);
> deepRS_iCaT_ICa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_ICa(1,:) =p.deepRS_iCaT_gCa.*(deepRS_iCaT_s(1,:).^2).*(deepRS_V(1,:)-p.deepRS_iCaT_ECa);
> deepRS_iCaT_as_last =1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)));
> deepRS_iCaT_as = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_as(1,:) =1.6./(1+exp(-.072*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-65)));
> deepRS_iCaT_bs_last =0.02*(deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)/5)-1);
> deepRS_iCaT_bs = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_bs(1,:) =0.02*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1);
> deepRS_iCaT_sinf_last =(( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCaT_sinf = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_sinf(1,:) =(( 1.6./(1+exp(-.072*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCaT_stau_last =1./((( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCaT_stau = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCaT_stau(1,:) =1./((( 1.6./(1+exp(-.072*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(1,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCarracedoEPSPs_Iext_last =p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:);
> deepRS_iCarracedoEPSPs_Iext = zeros(nsamp,p.deepRS_Npop);
> deepRS_iCarracedoEPSPs_Iext(1,:) =p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:);
> deepRS_iFMPulses_Iext_last =p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:)));
> deepRS_iFMPulses_Iext = zeros(nsamp,p.deepRS_Npop);
> deepRS_iFMPulses_Iext(1,:) =p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:)));
> deepRS_iFMPulses_input_last =deepRS_iFMPulses_s2(k,:);
> deepRS_iFMPulses_input = zeros(nsamp,p.deepRS_Npop);
> deepRS_iFMPulses_input(1,:) =deepRS_iFMPulses_s2(k,:);
> deepRS_iKCaT_IKCa_last =p.deepRS_iKCaT_gKCa*deepRS_iKCaT_q_last.*(deepRS_V_last-p.deepRS_iKCaT_EK);
> deepRS_iKCaT_IKCa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKCaT_IKCa(1,:) =p.deepRS_iKCaT_gKCa*deepRS_iKCaT_q(1,:).*(deepRS_V(1,:)-p.deepRS_iKCaT_EK);
> deepRS_iKCaT_aKCa_last =min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1);
> deepRS_iKCaT_aKCa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKCaT_aKCa(1,:) =min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(1,:),1);
> deepRS_iKCaT_infKCa_last =(( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKCaT_infKCa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKCaT_infKCa(1,:) =(( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(1,:),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(1,:),1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKCaT_tauKCa_last =1./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKCaT_tauKCa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKCaT_tauKCa(1,:) =1./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(1,:),1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKDRG_IKDR_last =(p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*deepRS_iKDRG_mKDR_last.^4.*(deepRS_V_last-p.deepRS_iKDRG_E_KDR);
> deepRS_iKDRG_IKDR = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKDRG_IKDR(1,:) =(p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*deepRS_iKDRG_mKDR(1,:).^4.*(deepRS_V(1,:)-p.deepRS_iKDRG_E_KDR);
> deepRS_iKDRG_aM_last =-.01*(deepRS_V_last+20-p.deepRS_iKDRG_Koffset)./(exp(-(deepRS_V_last+20-p.deepRS_iKDRG_Koffset)/10)-1);
> deepRS_iKDRG_aM = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKDRG_aM(1,:) =-.01*(deepRS_V(1,:)+20-p.deepRS_iKDRG_Koffset)./(exp(-(deepRS_V(1,:)+20-p.deepRS_iKDRG_Koffset)/10)-1);
> deepRS_iKDRG_bM_last =.125*exp(-(deepRS_V_last+30-p.deepRS_iKDRG_Koffset)/80);
> deepRS_iKDRG_bM = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKDRG_bM(1,:) =.125*exp(-(deepRS_V(1,:)+30-p.deepRS_iKDRG_Koffset)/80);
> deepRS_iKsConst_IKs_last =p.deepRS_iKsConst_gKCs.*deepRS_iKsConst_n_last.*(deepRS_V_last-p.deepRS_iKsConst_E_Ks);
> deepRS_iKsConst_IKs = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKsConst_IKs(1,:) =p.deepRS_iKsConst_gKCs.*deepRS_iKsConst_n(1,:).*(deepRS_V(1,:)-p.deepRS_iKsConst_E_Ks);
> deepRS_iKsConst_ninf_last =1./(1+exp(-(deepRS_V_last-p.deepRS_iKsConst_halfKs)/10));
> deepRS_iKsConst_ninf = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKsConst_ninf(1,:) =1./(1+exp(-(deepRS_V(1,:)-p.deepRS_iKsConst_halfKs)/10));
> deepRS_iKs_IKs_last =p.deepRS_iKs_gKs.*deepRS_iKs_n_last.*(deepRS_V_last-p.deepRS_iKs_E_Ks);
> deepRS_iKs_IKs = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKs_IKs(1,:) =p.deepRS_iKs_gKs.*deepRS_iKs_n(1,:).*(deepRS_V(1,:)-p.deepRS_iKs_E_Ks);
> deepRS_iKs_ninf_last =1./(1+exp(-(deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10));
> deepRS_iKs_ninf = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKs_ninf(1,:) =1./(1+exp(-(deepRS_V(1,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10));
> deepRS_iKs_tauKs_last =p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)));
> deepRS_iKs_tauKs = zeros(nsamp,p.deepRS_Npop);
> deepRS_iKs_tauKs(1,:) =p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((deepRS_V(1,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(deepRS_V(1,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)));
> deepRS_iLeak_Il_last =(p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(deepRS_V_last-p.deepRS_iLeak_El);
> deepRS_iLeak_Il = zeros(nsamp,p.deepRS_Npop);
> deepRS_iLeak_Il(1,:) =(p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(deepRS_V(1,:)-p.deepRS_iLeak_El);
> deepRS_iNaG_INa_last =(p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V_last+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*deepRS_iNaG_h_last.*(deepRS_V_last-p.deepRS_iNaG_ENa);
> deepRS_iNaG_INa = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_INa(1,:) =(p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V(1,:)+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*deepRS_iNaG_h(1,:).*(deepRS_V(1,:)-p.deepRS_iNaG_ENa);
> deepRS_iNaG_ah_last =.07*exp(-(deepRS_V_last+30-p.deepRS_iNaG_Noffset)/20);
> deepRS_iNaG_ah = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_ah(1,:) =.07*exp(-(deepRS_V(1,:)+30-p.deepRS_iNaG_Noffset)/20);
> deepRS_iNaG_am_last =-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1));
> deepRS_iNaG_am = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_am(1,:) =-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)/10)-1));
> deepRS_iNaG_bh_last =1./(exp(-(deepRS_V_last-p.deepRS_iNaG_Noffset)/10)+1);
> deepRS_iNaG_bh = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_bh(1,:) =1./(exp(-(deepRS_V(1,:)-p.deepRS_iNaG_Noffset)/10)+1);
> deepRS_iNaG_bm_last =4*exp(-(deepRS_V_last+41-p.deepRS_iNaG_Noffset)/18);
> deepRS_iNaG_bm = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_bm(1,:) =4*exp(-(deepRS_V(1,:)+41-p.deepRS_iNaG_Noffset)/18);
> deepRS_iNaG_minf_last =(( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V_last+41-p.deepRS_iNaG_Noffset)/18))));
> deepRS_iNaG_minf = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaG_minf(1,:) =(( -(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(1,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V(1,:)+41-p.deepRS_iNaG_Noffset)/18))));
> deepRS_iNaP_INaP_last =p.deepRS_iNaP_gNaP.*deepRS_iNaP_m_last.*(deepRS_V_last-p.deepRS_iNaP_ENa);
> deepRS_iNaP_INaP = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaP_INaP(1,:) =p.deepRS_iNaP_gNaP.*deepRS_iNaP_m(1,:).*(deepRS_V(1,:)-p.deepRS_iNaP_ENa);
> deepRS_iNaP_minf_last =1./(1+exp(-(deepRS_V_last-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5));
> deepRS_iNaP_minf = zeros(nsamp,p.deepRS_Npop);
> deepRS_iNaP_minf(1,:) =1./(1+exp(-(deepRS_V(1,:)-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5));
> deepRS_iPeriodicPulsesBen_Iext_last =p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:)));
> deepRS_iPeriodicPulsesBen_Iext = zeros(nsamp,p.deepRS_Npop);
> deepRS_iPeriodicPulsesBen_Iext(1,:) =p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:)));
> deepRS_iPeriodicPulsesBen_input_last =deepRS_iPeriodicPulsesBen_s2(k,:);
> deepRS_iPeriodicPulsesBen_input = zeros(nsamp,p.deepRS_Npop);
> deepRS_iPeriodicPulsesBen_input(1,:) =deepRS_iPeriodicPulsesBen_s2(k,:);
> deepRS_itonicBen_IBen_last =p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise);
> deepRS_itonicBen_IBen = zeros(nsamp,p.deepRS_Npop);
> deepRS_itonicBen_IBen(1,:) =p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise);
40,43c379,392
< pop1_v_k1 =(((( -p.pop1_iNa_gNa.*pop1_iNa_m(n-1).^3.*pop1_iNa_h(n-1).*(pop1_v(n-1)-p.pop1_iNa_ENa))))+(((( -p.pop1_iK_gK.*pop1_iK_n(n-1).^4.*(pop1_v(n-1)-p.pop1_iK_EK))))))+p.pop1_I;
< pop1_iNa_m_k1 = (( (2.5-.1*(pop1_v(n-1)+65))./(exp(2.5-.1*(pop1_v(n-1)+65))-1))).*(1-pop1_iNa_m(n-1))-(( 4*exp(-(pop1_v(n-1)+65)/18))).*pop1_iNa_m(n-1);
< pop1_iNa_h_k1 = (( .07*exp(-(pop1_v(n-1)+65)/20))).*(1-pop1_iNa_h(n-1))-(( 1./(exp(3-.1*(pop1_v(n-1)+65))+1))).*pop1_iNa_h(n-1);
< pop1_iK_n_k1 = (( (.1-.01*(pop1_v(n-1)+65))./(exp(1-.1*(pop1_v(n-1)+65))-1))).*(1-pop1_iK_n(n-1))-(( .125*exp(-(pop1_v(n-1)+65)/80))).*pop1_iK_n(n-1);
---
> deepFS_V_k1 =(((-(( p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset))))+(((( p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop))))+((-(( p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*deepFS_FSiNaF_hNaF_last.*(deepFS_V_last-p.deepFS_FSiNaF_E_NaF))))+((-(( p.deepFS_FSiKDR_gKDR.*deepFS_FSiKDR_mKDR_last.^4.*(deepFS_V_last-p.deepFS_FSiKDR_E_KDR))))+((-(( p.deepFS_IBleak_g_l.*(deepFS_V_last-p.deepFS_IBleak_E_l))))+((-(( (deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(deepFS_deepRS_IBaIBdbiSYNseed_s_last*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(deepFS_V_last-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN))))))))))))/p.deepFS_Cm;
> deepFS_FSiNaF_hNaF_k1 = (( (( 1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*(1-deepFS_FSiNaF_hNaF_last)-(( (1-(( 1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V_last+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*deepFS_FSiNaF_hNaF_last;
> deepFS_FSiKDR_mKDR_k1 = (( (( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(deepFS_V_last+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*(1-deepFS_FSiKDR_mKDR_last)-(( (1-(( 1./(1+exp((-deepFS_V_last-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(deepFS_V_last+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*deepFS_FSiKDR_mKDR_last;
> deepRS_V_k1 =(p.deepRS_I_const+((-((p.deepRS_iNaP_gNaP.*deepRS_iNaP_m_last.*(deepRS_V_last-p.deepRS_iNaP_ENa))))+((-((p.deepRS_iKs_gKs.*deepRS_iKs_n_last.*(deepRS_V_last-p.deepRS_iKs_E_Ks))))+((-((p.deepRS_iKsConst_gKCs.*deepRS_iKsConst_n_last.*(deepRS_V_last-p.deepRS_iKsConst_E_Ks))))+((-(( (p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*deepRS_iKDRG_mKDR_last.^4.*(deepRS_V_last-p.deepRS_iKDRG_E_KDR))))+((-(( (p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V_last+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V_last+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V_last+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*deepRS_iNaG_h_last.*(deepRS_V_last-p.deepRS_iNaG_ENa))))+((-(( (p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(deepRS_V_last-p.deepRS_iLeak_El))))+((-(( p.deepRS_iCaT_gCa.*(deepRS_iCaT_s_last.^2).*(deepRS_V_last-p.deepRS_iCaT_ECa))))+((-(( p.deepRS_iKCaT_gKCa*deepRS_iKCaT_q_last.*(deepRS_V_last-p.deepRS_iKCaT_EK))))+((-(( p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:))))))+((-((p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise))))+((-(( p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:))))))+((-((p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:))))+((-(( (deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(deepRS_deepFS_IBaIBdbiSYNseed_s_last*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(deepRS_V_last-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN)))))))))))))))))))/p.deepRS_Cm;
> deepRS_iNaP_m_k1 =(((1./(1+exp(-(deepRS_V_last-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5))))-deepRS_iNaP_m_last)/p.deepRS_iNaP_tauNaP;
> deepRS_iKs_n_k1 =(((1./(1+exp(-(deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10))))-deepRS_iKs_n_last)./((p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(deepRS_V_last-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)))));
> deepRS_iKsConst_n_k1 =(((1./(1+exp(-(deepRS_V_last-p.deepRS_iKsConst_halfKs)/10))))-deepRS_iKsConst_n_last)/p.deepRS_iKsConst_tau_Ks;
> deepRS_iKDRG_mKDR_k1 = deepRS_iKDRG_tau_m*((( -.01*(deepRS_V_last+20-p.deepRS_iKDRG_Koffset)./(exp(-(deepRS_V_last+20-p.deepRS_iKDRG_Koffset)/10)-1))).*(1-deepRS_iKDRG_mKDR_last)-(( .125*exp(-(deepRS_V_last+30-p.deepRS_iKDRG_Koffset)/80))).*deepRS_iKDRG_mKDR_last);
> deepRS_iNaG_h_k1 = deepRS_iNaG_tau_h*((( .07*exp(-(deepRS_V_last+30-p.deepRS_iNaG_Noffset)/20))).*(1-deepRS_iNaG_h_last)-(( 1./(exp(-(deepRS_V_last-p.deepRS_iNaG_Noffset)/10)+1))).*deepRS_iNaG_h_last);
> deepRS_CaDynT_cai_k1 = - p.deepRS_CaDynT_CAF.*(((( p.deepRS_iCaT_gCa.*(deepRS_iCaT_s_last.^2).*(deepRS_V_last-p.deepRS_iCaT_ECa))))) - deepRS_CaDynT_cai_last/p.deepRS_CaDynT_tauCa;
> deepRS_iCaT_s_k1 = ((( (( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))))-deepRS_iCaT_s_last)./(( 1./((( 1.6./(1+exp(-.072*(deepRS_V_last-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V_last-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))));
> deepRS_iKCaT_q_k1 = ((( (( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))+p.deepRS_iKCaT_bKCa)))-deepRS_iKCaT_q_last)./(( 1./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai_last,1)))+p.deepRS_iKCaT_bKCa)));
> deepFS_deepRS_IBaIBdbiSYNseed_s_k1 = -deepFS_deepRS_IBaIBdbiSYNseed_s_last./p.deepFS_deepRS_IBaIBdbiSYNseed_tauDx + ((1-deepFS_deepRS_IBaIBdbiSYNseed_s_last)/p.deepFS_deepRS_IBaIBdbiSYNseed_tauRx).*(1+tanh(deepRS_V_last/10));
> deepRS_deepFS_IBaIBdbiSYNseed_s_k1 = -deepRS_deepFS_IBaIBdbiSYNseed_s_last./p.deepRS_deepFS_IBaIBdbiSYNseed_tauDx + ((1-deepRS_deepFS_IBaIBdbiSYNseed_s_last)/p.deepRS_deepFS_IBaIBdbiSYNseed_tauRx).*(1+tanh(deepFS_V_last/10));
46,54c395,423
< pop1_v_k2 =(((( -p.pop1_iNa_gNa.*((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k1)).^3.*((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k1)).*(((pop1_v(n-1) + .5*dt*pop1_v_k1))-p.pop1_iNa_ENa))))+(((( -p.pop1_iK_gK.*((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k1)).^4.*(((pop1_v(n-1) + .5*dt*pop1_v_k1))-p.pop1_iK_EK))))))+p.pop1_I;
< pop1_iNa_m_k2 = (( (2.5-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65))./(exp(2.5-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65))-1))).*(1-((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k1)))-(( 4*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65)/18))).*((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k1));
< pop1_iNa_h_k2 = (( .07*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65)/20))).*(1-((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k1)))-(( 1./(exp(3-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65))+1))).*((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k1));
< pop1_iK_n_k2 = (( (.1-.01*(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65))./(exp(1-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65))-1))).*(1-((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k1)))-(( .125*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k1))+65)/80))).*((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k1));
< 
< pop1_v_k3 =(((( -p.pop1_iNa_gNa.*((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k2)).^3.*((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k2)).*(((pop1_v(n-1) + .5*dt*pop1_v_k2))-p.pop1_iNa_ENa))))+(((( -p.pop1_iK_gK.*((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k2)).^4.*(((pop1_v(n-1) + .5*dt*pop1_v_k2))-p.pop1_iK_EK))))))+p.pop1_I;
< pop1_iNa_m_k3 = (( (2.5-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65))./(exp(2.5-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65))-1))).*(1-((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k2)))-(( 4*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65)/18))).*((pop1_iNa_m(n-1) + .5*dt*pop1_iNa_m_k2));
< pop1_iNa_h_k3 = (( .07*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65)/20))).*(1-((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k2)))-(( 1./(exp(3-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65))+1))).*((pop1_iNa_h(n-1) + .5*dt*pop1_iNa_h_k2));
< pop1_iK_n_k3 = (( (.1-.01*(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65))./(exp(1-.1*(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65))-1))).*(1-((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k2)))-(( .125*exp(-(((pop1_v(n-1) + .5*dt*pop1_v_k2))+65)/80))).*((pop1_iK_n(n-1) + .5*dt*pop1_iK_n_k2));
---
> deepFS_V_k2 =(((-(( p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset))))+(((( p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop))))+((-(( p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k1)).*(((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_FSiNaF_E_NaF))))+((-(( p.deepFS_FSiKDR_gKDR.*((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k1)).^4.*(((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_FSiKDR_E_KDR))))+((-(( p.deepFS_IBleak_g_l.*(((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_IBleak_E_l))))+((-(( (deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k1))*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN))))))))))))/p.deepFS_Cm;
> deepFS_FSiNaF_hNaF_k2 = (( (( 1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*(1-((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k1)))-(( (1-(( 1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k1));
> deepFS_FSiKDR_mKDR_k2 = (( (( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*(1-((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k1)))-(( (1-(( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k1))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(((deepFS_V_last + .5*dt*deepFS_V_k1))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k1));
> deepRS_V_k2 =(p.deepRS_I_const+((-((p.deepRS_iNaP_gNaP.*((deepRS_iNaP_m_last + .5*dt*deepRS_iNaP_m_k1)).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iNaP_ENa))))+((-((p.deepRS_iKs_gKs.*((deepRS_iKs_n_last + .5*dt*deepRS_iKs_n_k1)).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iKs_E_Ks))))+((-((p.deepRS_iKsConst_gKCs.*((deepRS_iKsConst_n_last + .5*dt*deepRS_iKsConst_n_k1)).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iKsConst_E_Ks))))+((-(( (p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k1)).^4.*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iKDRG_E_KDR))))+((-(( (p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(((deepRS_V_last + .5*dt*deepRS_V_k1))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(((deepRS_V_last + .5*dt*deepRS_V_k1))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k1)).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iNaG_ENa))))+((-(( (p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iLeak_El))))+((-(( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k1)).^2).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_ECa))))+((-(( p.deepRS_iKCaT_gKCa*((deepRS_iKCaT_q_last + .5*dt*deepRS_iKCaT_q_k1)).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iKCaT_EK))))+((-(( p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:))))))+((-((p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise))))+((-(( p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:))))))+((-((p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:))))+((-(( (deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k1))*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN)))))))))))))))))))/p.deepRS_Cm;
> deepRS_iNaP_m_k2 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5))))-((deepRS_iNaP_m_last + .5*dt*deepRS_iNaP_m_k1)))/p.deepRS_iNaP_tauNaP;
> deepRS_iKs_n_k2 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10))))-((deepRS_iKs_n_last + .5*dt*deepRS_iKs_n_k1)))./((p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((((deepRS_V_last + .5*dt*deepRS_V_k1))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)))));
> deepRS_iKsConst_n_k2 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iKsConst_halfKs)/10))))-((deepRS_iKsConst_n_last + .5*dt*deepRS_iKsConst_n_k1)))/p.deepRS_iKsConst_tau_Ks;
> deepRS_iKDRG_mKDR_k2 = deepRS_iKDRG_tau_m*((( -.01*(((deepRS_V_last + .5*dt*deepRS_V_k1))+20-p.deepRS_iKDRG_Koffset)./(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+20-p.deepRS_iKDRG_Koffset)/10)-1))).*(1-((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k1)))-(( .125*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+30-p.deepRS_iKDRG_Koffset)/80))).*((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k1)));
> deepRS_iNaG_h_k2 = deepRS_iNaG_tau_h*((( .07*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))+30-p.deepRS_iNaG_Noffset)/20))).*(1-((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k1)))-(( 1./(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iNaG_Noffset)/10)+1))).*((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k1)));
> deepRS_CaDynT_cai_k2 = - p.deepRS_CaDynT_CAF.*(((( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k1)).^2).*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_ECa))))) - ((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k1))/p.deepRS_CaDynT_tauCa;
> deepRS_iCaT_s_k2 = ((( (( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))))-((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k1)))./(( 1./((( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + .5*dt*deepRS_V_k1))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))));
> deepRS_iKCaT_q_k2 = ((( (( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k1)),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k1)),1)))+p.deepRS_iKCaT_bKCa)))-((deepRS_iKCaT_q_last + .5*dt*deepRS_iKCaT_q_k1)))./(( 1./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k1)),1)))+p.deepRS_iKCaT_bKCa)));
> deepFS_deepRS_IBaIBdbiSYNseed_s_k2 = -((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k1))./p.deepFS_deepRS_IBaIBdbiSYNseed_tauDx + ((1-((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k1)))/p.deepFS_deepRS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepRS_V_last + .5*dt*deepRS_V_k1))/10));
> deepRS_deepFS_IBaIBdbiSYNseed_s_k2 = -((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k1))./p.deepRS_deepFS_IBaIBdbiSYNseed_tauDx + ((1-((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k1)))/p.deepRS_deepFS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepFS_V_last + .5*dt*deepFS_V_k1))/10));
> 
> deepFS_V_k3 =(((-(( p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset))))+(((( p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop))))+((-(( p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k2)).*(((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_FSiNaF_E_NaF))))+((-(( p.deepFS_FSiKDR_gKDR.*((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k2)).^4.*(((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_FSiKDR_E_KDR))))+((-(( p.deepFS_IBleak_g_l.*(((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_IBleak_E_l))))+((-(( (deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k2))*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN))))))))))))/p.deepFS_Cm;
> deepFS_FSiNaF_hNaF_k3 = (( (( 1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*(1-((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k2)))-(( (1-(( 1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*((deepFS_FSiNaF_hNaF_last + .5*dt*deepFS_FSiNaF_hNaF_k2));
> deepFS_FSiKDR_mKDR_k3 = (( (( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*(1-((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k2)))-(( (1-(( 1./(1+exp((-((deepFS_V_last + .5*dt*deepFS_V_k2))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(((deepFS_V_last + .5*dt*deepFS_V_k2))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*((deepFS_FSiKDR_mKDR_last + .5*dt*deepFS_FSiKDR_mKDR_k2));
> deepRS_V_k3 =(p.deepRS_I_const+((-((p.deepRS_iNaP_gNaP.*((deepRS_iNaP_m_last + .5*dt*deepRS_iNaP_m_k2)).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iNaP_ENa))))+((-((p.deepRS_iKs_gKs.*((deepRS_iKs_n_last + .5*dt*deepRS_iKs_n_k2)).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iKs_E_Ks))))+((-((p.deepRS_iKsConst_gKCs.*((deepRS_iKsConst_n_last + .5*dt*deepRS_iKsConst_n_k2)).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iKsConst_E_Ks))))+((-(( (p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k2)).^4.*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iKDRG_E_KDR))))+((-(( (p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(((deepRS_V_last + .5*dt*deepRS_V_k2))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(((deepRS_V_last + .5*dt*deepRS_V_k2))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k2)).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iNaG_ENa))))+((-(( (p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iLeak_El))))+((-(( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k2)).^2).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_ECa))))+((-(( p.deepRS_iKCaT_gKCa*((deepRS_iKCaT_q_last + .5*dt*deepRS_iKCaT_q_k2)).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iKCaT_EK))))+((-(( p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:))))))+((-((p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise))))+((-(( p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:))))))+((-((p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:))))+((-(( (deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k2))*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN)))))))))))))))))))/p.deepRS_Cm;
> deepRS_iNaP_m_k3 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5))))-((deepRS_iNaP_m_last + .5*dt*deepRS_iNaP_m_k2)))/p.deepRS_iNaP_tauNaP;
> deepRS_iKs_n_k3 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10))))-((deepRS_iKs_n_last + .5*dt*deepRS_iKs_n_k2)))./((p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((((deepRS_V_last + .5*dt*deepRS_V_k2))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)))));
> deepRS_iKsConst_n_k3 =(((1./(1+exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iKsConst_halfKs)/10))))-((deepRS_iKsConst_n_last + .5*dt*deepRS_iKsConst_n_k2)))/p.deepRS_iKsConst_tau_Ks;
> deepRS_iKDRG_mKDR_k3 = deepRS_iKDRG_tau_m*((( -.01*(((deepRS_V_last + .5*dt*deepRS_V_k2))+20-p.deepRS_iKDRG_Koffset)./(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+20-p.deepRS_iKDRG_Koffset)/10)-1))).*(1-((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k2)))-(( .125*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+30-p.deepRS_iKDRG_Koffset)/80))).*((deepRS_iKDRG_mKDR_last + .5*dt*deepRS_iKDRG_mKDR_k2)));
> deepRS_iNaG_h_k3 = deepRS_iNaG_tau_h*((( .07*exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))+30-p.deepRS_iNaG_Noffset)/20))).*(1-((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k2)))-(( 1./(exp(-(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iNaG_Noffset)/10)+1))).*((deepRS_iNaG_h_last + .5*dt*deepRS_iNaG_h_k2)));
> deepRS_CaDynT_cai_k3 = - p.deepRS_CaDynT_CAF.*(((( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k2)).^2).*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_ECa))))) - ((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k2))/p.deepRS_CaDynT_tauCa;
> deepRS_iCaT_s_k3 = ((( (( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))))-((deepRS_iCaT_s_last + .5*dt*deepRS_iCaT_s_k2)))./(( 1./((( 1.6./(1+exp(-.072*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + .5*dt*deepRS_V_k2))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))));
> deepRS_iKCaT_q_k3 = ((( (( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k2)),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k2)),1)))+p.deepRS_iKCaT_bKCa)))-((deepRS_iKCaT_q_last + .5*dt*deepRS_iKCaT_q_k2)))./(( 1./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + .5*dt*deepRS_CaDynT_cai_k2)),1)))+p.deepRS_iKCaT_bKCa)));
> deepFS_deepRS_IBaIBdbiSYNseed_s_k3 = -((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k2))./p.deepFS_deepRS_IBaIBdbiSYNseed_tauDx + ((1-((deepFS_deepRS_IBaIBdbiSYNseed_s_last + .5*dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k2)))/p.deepFS_deepRS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepRS_V_last + .5*dt*deepRS_V_k2))/10));
> deepRS_deepFS_IBaIBdbiSYNseed_s_k3 = -((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k2))./p.deepRS_deepFS_IBaIBdbiSYNseed_tauDx + ((1-((deepRS_deepFS_IBaIBdbiSYNseed_s_last + .5*dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k2)))/p.deepRS_deepFS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepFS_V_last + .5*dt*deepFS_V_k2))/10));
57,60c426,439
< pop1_v_k4 =(((( -p.pop1_iNa_gNa.*((pop1_iNa_m(n-1) + dt*pop1_iNa_m_k3)).^3.*((pop1_iNa_h(n-1) + dt*pop1_iNa_h_k3)).*(((pop1_v(n-1) + dt*pop1_v_k3))-p.pop1_iNa_ENa))))+(((( -p.pop1_iK_gK.*((pop1_iK_n(n-1) + dt*pop1_iK_n_k3)).^4.*(((pop1_v(n-1) + dt*pop1_v_k3))-p.pop1_iK_EK))))))+p.pop1_I;
< pop1_iNa_m_k4 = (( (2.5-.1*(((pop1_v(n-1) + dt*pop1_v_k3))+65))./(exp(2.5-.1*(((pop1_v(n-1) + dt*pop1_v_k3))+65))-1))).*(1-((pop1_iNa_m(n-1) + dt*pop1_iNa_m_k3)))-(( 4*exp(-(((pop1_v(n-1) + dt*pop1_v_k3))+65)/18))).*((pop1_iNa_m(n-1) + dt*pop1_iNa_m_k3));
< pop1_iNa_h_k4 = (( .07*exp(-(((pop1_v(n-1) + dt*pop1_v_k3))+65)/20))).*(1-((pop1_iNa_h(n-1) + dt*pop1_iNa_h_k3)))-(( 1./(exp(3-.1*(((pop1_v(n-1) + dt*pop1_v_k3))+65))+1))).*((pop1_iNa_h(n-1) + dt*pop1_iNa_h_k3));
< pop1_iK_n_k4 = (( (.1-.01*(((pop1_v(n-1) + dt*pop1_v_k3))+65))./(exp(1-.1*(((pop1_v(n-1) + dt*pop1_v_k3))+65))-1))).*(1-((pop1_iK_n(n-1) + dt*pop1_iK_n_k3)))-(( .125*exp(-(((pop1_v(n-1) + dt*pop1_v_k3))+65)/80))).*((pop1_iK_n(n-1) + dt*pop1_iK_n_k3));
---
> deepFS_V_k4 =(((-(( p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset))))+(((( p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop))))+((-(( p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*((deepFS_FSiNaF_hNaF_last + dt*deepFS_FSiNaF_hNaF_k3)).*(((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_FSiNaF_E_NaF))))+((-(( p.deepFS_FSiKDR_gKDR.*((deepFS_FSiKDR_mKDR_last + dt*deepFS_FSiKDR_mKDR_k3)).^4.*(((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_FSiKDR_E_KDR))))+((-(( p.deepFS_IBleak_g_l.*(((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_IBleak_E_l))))+((-(( (deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(((deepFS_deepRS_IBaIBdbiSYNseed_s_last + dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k3))*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN))))))))))))/p.deepFS_Cm;
> deepFS_FSiNaF_hNaF_k4 = (( (( 1./(1+exp((((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*(1-((deepFS_FSiNaF_hNaF_last + dt*deepFS_FSiNaF_hNaF_k3)))-(( (1-(( 1./(1+exp((((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2)))))).*((deepFS_FSiNaF_hNaF_last + dt*deepFS_FSiNaF_hNaF_k3));
> deepFS_FSiKDR_mKDR_k4 = (( (( 1./(1+exp((-((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*(1-((deepFS_FSiKDR_mKDR_last + dt*deepFS_FSiKDR_mKDR_k3)))-(( (1-(( 1./(1+exp((-((deepFS_V_last + dt*deepFS_V_k3))-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(((deepFS_V_last + dt*deepFS_V_k3))+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2))))).*((deepFS_FSiKDR_mKDR_last + dt*deepFS_FSiKDR_mKDR_k3));
> deepRS_V_k4 =(p.deepRS_I_const+((-((p.deepRS_iNaP_gNaP.*((deepRS_iNaP_m_last + dt*deepRS_iNaP_m_k3)).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iNaP_ENa))))+((-((p.deepRS_iKs_gKs.*((deepRS_iKs_n_last + dt*deepRS_iKs_n_k3)).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iKs_E_Ks))))+((-((p.deepRS_iKsConst_gKCs.*((deepRS_iKsConst_n_last + dt*deepRS_iKsConst_n_k3)).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iKsConst_E_Ks))))+((-(( (p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*((deepRS_iKDRG_mKDR_last + dt*deepRS_iKDRG_mKDR_k3)).^4.*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iKDRG_E_KDR))))+((-(( (p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(((deepRS_V_last + dt*deepRS_V_k3))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + dt*deepRS_V_k3))+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(((deepRS_V_last + dt*deepRS_V_k3))+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(((deepRS_V_last + dt*deepRS_V_k3))+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(((deepRS_V_last + dt*deepRS_V_k3))+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*((deepRS_iNaG_h_last + dt*deepRS_iNaG_h_k3)).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iNaG_ENa))))+((-(( (p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iLeak_El))))+((-(( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + dt*deepRS_iCaT_s_k3)).^2).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_ECa))))+((-(( p.deepRS_iKCaT_gKCa*((deepRS_iKCaT_q_last + dt*deepRS_iKCaT_q_k3)).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iKCaT_EK))))+((-(( p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:))))))+((-((p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise))))+((-(( p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:))))))+((-((p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:))))+((-(( (deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(((deepRS_deepFS_IBaIBdbiSYNseed_s_last + dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k3))*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN)))))))))))))))))))/p.deepRS_Cm;
> deepRS_iNaP_m_k4 =(((1./(1+exp(-(((deepRS_V_last + dt*deepRS_V_k3))-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5))))-((deepRS_iNaP_m_last + dt*deepRS_iNaP_m_k3)))/p.deepRS_iNaP_tauNaP;
> deepRS_iKs_n_k4 =(((1./(1+exp(-(((deepRS_V_last + dt*deepRS_V_k3))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10))))-((deepRS_iKs_n_last + dt*deepRS_iKs_n_k3)))./((p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((((deepRS_V_last + dt*deepRS_V_k3))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(((deepRS_V_last + dt*deepRS_V_k3))-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)))));
> deepRS_iKsConst_n_k4 =(((1./(1+exp(-(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iKsConst_halfKs)/10))))-((deepRS_iKsConst_n_last + dt*deepRS_iKsConst_n_k3)))/p.deepRS_iKsConst_tau_Ks;
> deepRS_iKDRG_mKDR_k4 = deepRS_iKDRG_tau_m*((( -.01*(((deepRS_V_last + dt*deepRS_V_k3))+20-p.deepRS_iKDRG_Koffset)./(exp(-(((deepRS_V_last + dt*deepRS_V_k3))+20-p.deepRS_iKDRG_Koffset)/10)-1))).*(1-((deepRS_iKDRG_mKDR_last + dt*deepRS_iKDRG_mKDR_k3)))-(( .125*exp(-(((deepRS_V_last + dt*deepRS_V_k3))+30-p.deepRS_iKDRG_Koffset)/80))).*((deepRS_iKDRG_mKDR_last + dt*deepRS_iKDRG_mKDR_k3)));
> deepRS_iNaG_h_k4 = deepRS_iNaG_tau_h*((( .07*exp(-(((deepRS_V_last + dt*deepRS_V_k3))+30-p.deepRS_iNaG_Noffset)/20))).*(1-((deepRS_iNaG_h_last + dt*deepRS_iNaG_h_k3)))-(( 1./(exp(-(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iNaG_Noffset)/10)+1))).*((deepRS_iNaG_h_last + dt*deepRS_iNaG_h_k3)));
> deepRS_CaDynT_cai_k4 = - p.deepRS_CaDynT_CAF.*(((( p.deepRS_iCaT_gCa.*(((deepRS_iCaT_s_last + dt*deepRS_iCaT_s_k3)).^2).*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_ECa))))) - ((deepRS_CaDynT_cai_last + dt*deepRS_CaDynT_cai_k3))/p.deepRS_CaDynT_tauCa;
> deepRS_iCaT_s_k4 = ((( (( 1.6./(1+exp(-.072*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))))-((deepRS_iCaT_s_last + dt*deepRS_iCaT_s_k3)))./(( 1./((( 1.6./(1+exp(-.072*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-51.1)./(exp((((deepRS_V_last + dt*deepRS_V_k3))-p.deepRS_iCaT_Caoffset-51.1)/5)-1))))));
> deepRS_iKCaT_q_k4 = ((( (( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + dt*deepRS_CaDynT_cai_k3)),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + dt*deepRS_CaDynT_cai_k3)),1)))+p.deepRS_iKCaT_bKCa)))-((deepRS_iKCaT_q_last + dt*deepRS_iKCaT_q_k3)))./(( 1./((( min(p.deepRS_iKCaT_aKCa_factor.*((deepRS_CaDynT_cai_last + dt*deepRS_CaDynT_cai_k3)),1)))+p.deepRS_iKCaT_bKCa)));
> deepFS_deepRS_IBaIBdbiSYNseed_s_k4 = -((deepFS_deepRS_IBaIBdbiSYNseed_s_last + dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k3))./p.deepFS_deepRS_IBaIBdbiSYNseed_tauDx + ((1-((deepFS_deepRS_IBaIBdbiSYNseed_s_last + dt*deepFS_deepRS_IBaIBdbiSYNseed_s_k3)))/p.deepFS_deepRS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepRS_V_last + dt*deepRS_V_k3))/10));
> deepRS_deepFS_IBaIBdbiSYNseed_s_k4 = -((deepRS_deepFS_IBaIBdbiSYNseed_s_last + dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k3))./p.deepRS_deepFS_IBaIBdbiSYNseed_tauDx + ((1-((deepRS_deepFS_IBaIBdbiSYNseed_s_last + dt*deepRS_deepFS_IBaIBdbiSYNseed_s_k3)))/p.deepRS_deepFS_IBaIBdbiSYNseed_tauRx).*(1+tanh(((deepFS_V_last + dt*deepFS_V_k3))/10));
65,68c444,530
< pop1_v(n) = pop1_v(n-1)+(dt/6)*(pop1_v_k1 + 2*(pop1_v_k2 + pop1_v_k3) + pop1_v_k4);
< pop1_iNa_m(n) = pop1_iNa_m(n-1)+(dt/6)*(pop1_iNa_m_k1 + 2*(pop1_iNa_m_k2 + pop1_iNa_m_k3) + pop1_iNa_m_k4);
< pop1_iNa_h(n) = pop1_iNa_h(n-1)+(dt/6)*(pop1_iNa_h_k1 + 2*(pop1_iNa_h_k2 + pop1_iNa_h_k3) + pop1_iNa_h_k4);
< pop1_iK_n(n) = pop1_iK_n(n-1)+(dt/6)*(pop1_iK_n_k1 + 2*(pop1_iK_n_k2 + pop1_iK_n_k3) + pop1_iK_n_k4);
---
> deepFS_V_last = deepFS_V_last+(dt/6)*(deepFS_V_k1 + 2*(deepFS_V_k2 + deepFS_V_k3) + deepFS_V_k4);
> deepFS_FSiNaF_hNaF_last = deepFS_FSiNaF_hNaF_last+(dt/6)*(deepFS_FSiNaF_hNaF_k1 + 2*(deepFS_FSiNaF_hNaF_k2 + deepFS_FSiNaF_hNaF_k3) + deepFS_FSiNaF_hNaF_k4);
> deepFS_FSiKDR_mKDR_last = deepFS_FSiKDR_mKDR_last+(dt/6)*(deepFS_FSiKDR_mKDR_k1 + 2*(deepFS_FSiKDR_mKDR_k2 + deepFS_FSiKDR_mKDR_k3) + deepFS_FSiKDR_mKDR_k4);
> deepRS_V_last = deepRS_V_last+(dt/6)*(deepRS_V_k1 + 2*(deepRS_V_k2 + deepRS_V_k3) + deepRS_V_k4);
> deepRS_iNaP_m_last = deepRS_iNaP_m_last+(dt/6)*(deepRS_iNaP_m_k1 + 2*(deepRS_iNaP_m_k2 + deepRS_iNaP_m_k3) + deepRS_iNaP_m_k4);
> deepRS_iKs_n_last = deepRS_iKs_n_last+(dt/6)*(deepRS_iKs_n_k1 + 2*(deepRS_iKs_n_k2 + deepRS_iKs_n_k3) + deepRS_iKs_n_k4);
> deepRS_iKsConst_n_last = deepRS_iKsConst_n_last+(dt/6)*(deepRS_iKsConst_n_k1 + 2*(deepRS_iKsConst_n_k2 + deepRS_iKsConst_n_k3) + deepRS_iKsConst_n_k4);
> deepRS_iKDRG_mKDR_last = deepRS_iKDRG_mKDR_last+(dt/6)*(deepRS_iKDRG_mKDR_k1 + 2*(deepRS_iKDRG_mKDR_k2 + deepRS_iKDRG_mKDR_k3) + deepRS_iKDRG_mKDR_k4);
> deepRS_iNaG_h_last = deepRS_iNaG_h_last+(dt/6)*(deepRS_iNaG_h_k1 + 2*(deepRS_iNaG_h_k2 + deepRS_iNaG_h_k3) + deepRS_iNaG_h_k4);
> deepRS_CaDynT_cai_last = deepRS_CaDynT_cai_last+(dt/6)*(deepRS_CaDynT_cai_k1 + 2*(deepRS_CaDynT_cai_k2 + deepRS_CaDynT_cai_k3) + deepRS_CaDynT_cai_k4);
> deepRS_iCaT_s_last = deepRS_iCaT_s_last+(dt/6)*(deepRS_iCaT_s_k1 + 2*(deepRS_iCaT_s_k2 + deepRS_iCaT_s_k3) + deepRS_iCaT_s_k4);
> deepRS_iKCaT_q_last = deepRS_iKCaT_q_last+(dt/6)*(deepRS_iKCaT_q_k1 + 2*(deepRS_iKCaT_q_k2 + deepRS_iKCaT_q_k3) + deepRS_iKCaT_q_k4);
> deepFS_deepRS_IBaIBdbiSYNseed_s_last = deepFS_deepRS_IBaIBdbiSYNseed_s_last+(dt/6)*(deepFS_deepRS_IBaIBdbiSYNseed_s_k1 + 2*(deepFS_deepRS_IBaIBdbiSYNseed_s_k2 + deepFS_deepRS_IBaIBdbiSYNseed_s_k3) + deepFS_deepRS_IBaIBdbiSYNseed_s_k4);
> deepRS_deepFS_IBaIBdbiSYNseed_s_last = deepRS_deepFS_IBaIBdbiSYNseed_s_last+(dt/6)*(deepRS_deepFS_IBaIBdbiSYNseed_s_k1 + 2*(deepRS_deepFS_IBaIBdbiSYNseed_s_k2 + deepRS_deepFS_IBaIBdbiSYNseed_s_k3) + deepRS_deepFS_IBaIBdbiSYNseed_s_k4);
> 
> if mod(k,downsample_factor)==0 % store this time point
> 
> % ------------------------------------------------------------
> % Store state variables:
> % ------------------------------------------------------------
> deepFS_V(n) = deepFS_V_last;
> deepFS_FSiNaF_hNaF(n) = deepFS_FSiNaF_hNaF_last;
> deepFS_FSiKDR_mKDR(n) = deepFS_FSiKDR_mKDR_last;
> deepRS_V(n) = deepRS_V_last;
> deepRS_iNaP_m(n) = deepRS_iNaP_m_last;
> deepRS_iKs_n(n) = deepRS_iKs_n_last;
> deepRS_iKsConst_n(n) = deepRS_iKsConst_n_last;
> deepRS_iKDRG_mKDR(n) = deepRS_iKDRG_mKDR_last;
> deepRS_iNaG_h(n) = deepRS_iNaG_h_last;
> deepRS_CaDynT_cai(n) = deepRS_CaDynT_cai_last;
> deepRS_iCaT_s(n) = deepRS_iCaT_s_last;
> deepRS_iKCaT_q(n) = deepRS_iKCaT_q_last;
> deepFS_deepRS_IBaIBdbiSYNseed_s(n) = deepFS_deepRS_IBaIBdbiSYNseed_s_last;
> deepRS_deepFS_IBaIBdbiSYNseed_s(n) = deepRS_deepFS_IBaIBdbiSYNseed_s_last;
> 
> % ------------------------------------------------------------
> % Update monitors:
> % ------------------------------------------------------------
> deepFS_FSiKDR_IKDR(n,:) =p.deepFS_FSiKDR_gKDR.*deepFS_FSiKDR_mKDR(n,:).^4.*(deepFS_V(n,:)-p.deepFS_FSiKDR_E_KDR);
> deepFS_FSiKDR_aM(n,:) =(( 1./(1+exp((-deepFS_V(n,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))) ./ (( .25+4.35*exp(-abs(deepFS_V(n,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_bM(n,:) =(1-(( 1./(1+exp((-deepFS_V(n,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1)))))./(( .25+4.35*exp(-abs(deepFS_V(n,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2)));
> deepFS_FSiKDR_minf(n,:) =1./(1+exp((-deepFS_V(n,:)-p.deepFS_FSiKDR_KDR_V1+p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d1));
> deepFS_FSiKDR_mtau(n,:) =.25+4.35*exp(-abs(deepFS_V(n,:)+p.deepFS_FSiKDR_KDR_V2-p.deepFS_FSiKDR_KDR_offset)/p.deepFS_FSiKDR_KDR_d2);
> deepFS_FSiNaF_INaF(n,:) =p.deepFS_FSiNaF_gNaF.*(( 1./(1+exp((-deepFS_V(n,:)-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10)))).^3.*deepFS_FSiNaF_hNaF(n,:).*(deepFS_V(n,:)-p.deepFS_FSiNaF_E_NaF);
> deepFS_FSiNaF_aH(n,:) =(( 1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))) ./ (( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_bH(n,:) =(1-(( 1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1)))))./(( p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2))));
> deepFS_FSiNaF_hinf(n,:) =1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V1-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d1));
> deepFS_FSiNaF_htau(n,:) =p.deepFS_FSiNaF_NaF_c0 + p.deepFS_FSiNaF_NaF_c1./(1+exp((deepFS_V(n,:)+p.deepFS_FSiNaF_NaF_V2-p.deepFS_FSiNaF_NaF_offset)/p.deepFS_FSiNaF_NaF_d2));
> deepFS_FSiNaF_m0(n,:) =1./(1+exp((-deepFS_V(n,:)-p.deepFS_FSiNaF_NaF_V0+p.deepFS_FSiNaF_NaF_offset)/10));
> deepFS_IBitonic_Itonic(n,:) =p.deepFS_IBitonic_stim*(t>p.deepFS_IBitonic_onset & t<p.deepFS_IBitonic_offset);
> deepFS_IBleak_Ileak(n,:) =p.deepFS_IBleak_g_l.*(deepFS_V(n,:)-p.deepFS_IBleak_E_l);
> deepFS_IBnoise_Inoise(n,:) =p.deepFS_IBnoise_V_noise.*randn(1,p.deepFS_Npop);
> deepFS_deepRS_IBaIBdbiSYNseed_ISYN(n,:) =(deepFS_deepRS_IBaIBdbiSYNseed_gsyn.*(deepFS_deepRS_IBaIBdbiSYNseed_s(n,:)*deepFS_deepRS_IBaIBdbiSYNseed_mask).*(deepFS_V(n,:)-p.deepFS_deepRS_IBaIBdbiSYNseed_E_SYN));
> deepRS_deepFS_IBaIBdbiSYNseed_ISYN(n,:) =(deepRS_deepFS_IBaIBdbiSYNseed_gsyn.*(deepRS_deepFS_IBaIBdbiSYNseed_s(n,:)*deepRS_deepFS_IBaIBdbiSYNseed_mask).*(deepRS_V(n,:)-p.deepRS_deepFS_IBaIBdbiSYNseed_E_SYN));
> deepRS_iCaT_ICa(n,:) =p.deepRS_iCaT_gCa.*(deepRS_iCaT_s(n,:).^2).*(deepRS_V(n,:)-p.deepRS_iCaT_ECa);
> deepRS_iCaT_as(n,:) =1.6./(1+exp(-.072*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-65)));
> deepRS_iCaT_bs(n,:) =0.02*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1);
> deepRS_iCaT_sinf(n,:) =(( 1.6./(1+exp(-.072*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-65)))))./((( 1.6./(1+exp(-.072*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCaT_stau(n,:) =1./((( 1.6./(1+exp(-.072*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-65)))))+(( 0.02*(deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)./(exp((deepRS_V(n,:)-p.deepRS_iCaT_Caoffset-51.1)/5)-1))));
> deepRS_iCarracedoEPSPs_Iext(n,:) =p.deepRS_iCarracedoEPSPs_gCar*deepRS_iCarracedoEPSPs_epsps(k,:);
> deepRS_iFMPulses_Iext(n,:) =p.deepRS_iFMPulses_FMPstim*(( deepRS_iFMPulses_s2(k,:)));
> deepRS_iFMPulses_input(n,:) =deepRS_iFMPulses_s2(k,:);
> deepRS_iKCaT_IKCa(n,:) =p.deepRS_iKCaT_gKCa*deepRS_iKCaT_q(n,:).*(deepRS_V(n,:)-p.deepRS_iKCaT_EK);
> deepRS_iKCaT_aKCa(n,:) =min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(n,:),1);
> deepRS_iKCaT_infKCa(n,:) =(( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(n,:),1)))./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(n,:),1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKCaT_tauKCa(n,:) =1./((( min(p.deepRS_iKCaT_aKCa_factor.*deepRS_CaDynT_cai(n,:),1)))+p.deepRS_iKCaT_bKCa);
> deepRS_iKDRG_IKDR(n,:) =(p.deepRS_iKDRG_gKDR/p.deepRS_iKDRG_gdenomK).*deepRS_iKDRG_mKDR(n,:).^4.*(deepRS_V(n,:)-p.deepRS_iKDRG_E_KDR);
> deepRS_iKDRG_aM(n,:) =-.01*(deepRS_V(n,:)+20-p.deepRS_iKDRG_Koffset)./(exp(-(deepRS_V(n,:)+20-p.deepRS_iKDRG_Koffset)/10)-1);
> deepRS_iKDRG_bM(n,:) =.125*exp(-(deepRS_V(n,:)+30-p.deepRS_iKDRG_Koffset)/80);
> deepRS_iKsConst_IKs(n,:) =p.deepRS_iKsConst_gKCs.*deepRS_iKsConst_n(n,:).*(deepRS_V(n,:)-p.deepRS_iKsConst_E_Ks);
> deepRS_iKsConst_ninf(n,:) =1./(1+exp(-(deepRS_V(n,:)-p.deepRS_iKsConst_halfKs)/10));
> deepRS_iKs_IKs(n,:) =p.deepRS_iKs_gKs.*deepRS_iKs_n(n,:).*(deepRS_V(n,:)-p.deepRS_iKs_E_Ks);
> deepRS_iKs_ninf(n,:) =1./(1+exp(-(deepRS_V(n,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./10));
> deepRS_iKs_tauKs(n,:) =p.deepRS_iKs_tau_mult.*1000./(3.3.*deepRS_iKs_tau_div.*(exp((deepRS_V(n,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./40)+exp(-(deepRS_V(n,:)-(p.deepRS_iKs_halfKs+p.deepRS_iKs_Ks_offset))./20)));
> deepRS_iLeak_Il(n,:) =(p.deepRS_iLeak_gl/p.deepRS_iLeak_gdenoml).*(deepRS_V(n,:)-p.deepRS_iLeak_El);
> deepRS_iNaG_INa(n,:) =(p.deepRS_iNaG_gNa/p.deepRS_iNaG_gdenomN)*((( (( -(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V(n,:)+41-p.deepRS_iNaG_Noffset)/18)))))).^3).*deepRS_iNaG_h(n,:).*(deepRS_V(n,:)-p.deepRS_iNaG_ENa);
> deepRS_iNaG_ah(n,:) =.07*exp(-(deepRS_V(n,:)+30-p.deepRS_iNaG_Noffset)/20);
> deepRS_iNaG_am(n,:) =-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)/10)-1));
> deepRS_iNaG_bh(n,:) =1./(exp(-(deepRS_V(n,:)-p.deepRS_iNaG_Noffset)/10)+1);
> deepRS_iNaG_bm(n,:) =4*exp(-(deepRS_V(n,:)+41-p.deepRS_iNaG_Noffset)/18);
> deepRS_iNaG_minf(n,:) =(( -(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))./((( -(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)./(10*(exp(-(deepRS_V(n,:)+16-p.deepRS_iNaG_Noffset)/10)-1))))+(( 4*exp(-(deepRS_V(n,:)+41-p.deepRS_iNaG_Noffset)/18))));
> deepRS_iNaP_INaP(n,:) =p.deepRS_iNaP_gNaP.*deepRS_iNaP_m(n,:).*(deepRS_V(n,:)-p.deepRS_iNaP_ENa);
> deepRS_iNaP_minf(n,:) =1./(1+exp(-(deepRS_V(n,:)-(p.deepRS_iNaP_halfNaP+p.deepRS_iNaP_NaP_offset))/5));
> deepRS_iPeriodicPulsesBen_Iext(n,:) =p.deepRS_iPeriodicPulsesBen_PPstim*(( deepRS_iPeriodicPulsesBen_s2(k,:)));
> deepRS_iPeriodicPulsesBen_input(n,:) =deepRS_iPeriodicPulsesBen_s2(k,:);
> deepRS_itonicBen_IBen(n,:) =p.deepRS_itonicBen_I_app*((t/p.deepRS_itonicBen_ton)*(t<=p.deepRS_itonicBen_ton)+(p.deepRS_itonicBen_ton<t&t<deepRS_itonicBen_toff)+rand(1,p.deepRS_Npop)*p.deepRS_itonicBen_Inoise);
> 
70a533
> end

